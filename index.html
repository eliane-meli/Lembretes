<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lembretes de Atividades Di√°rias - Sistema Inteligente</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* Estilo para modo sobreposto */
        body.overlay-mode {
            background: transparent;
            padding: 0;
            margin: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 2147483647;
            pointer-events: none;
        }
        
        .overlay-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.01);
            z-index: -1;
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            padding: 25px;
            position: relative;
            z-index: 1;
            pointer-events: auto;
            border: 1px solid #e2e8f0;
        }
        
        body.overlay-mode .container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid #3498db;
            box-shadow: 0 0 40px rgba(52, 152, 219, 0.3);
            animation: pulseGlow 3s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(52, 152, 219, 0.3); }
            50% { box-shadow: 0 0 50px rgba(52, 152, 219, 0.5); }
        }
        
        h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #1a202c;
            font-size: 2.2em;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .activities-list {
            margin-bottom: 35px;
        }
        
        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 18px;
            border-bottom: 1px solid #edf2f7;
            transition: all 0.3s ease;
            border-radius: 8px;
            margin-bottom: 5px;
        }
        
        .activity-item:hover {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .activity-item.completed {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-left: 4px solid #2ecc71;
            text-decoration: line-through;
            color: #27ae60;
        }
        
        .activity-info {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .activity-time {
            font-weight: 700;
            color: #2c3e50;
            margin-right: 20px;
            min-width: 70px;
            background: #edf2f7;
            padding: 6px 12px;
            border-radius: 6px;
            text-align: center;
            font-size: 1.1em;
        }
        
        .activity-name {
            flex: 1;
            font-size: 1.05em;
            color: #2d3748;
        }
        
        .activity-checkbox {
            margin-left: 20px;
        }
        
        .activity-checkbox input {
            transform: scale(1.5);
            accent-color: #3498db;
            cursor: pointer;
        }
        
        /* Notifica√ß√£o Principal Aprimorada */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 420px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.25);
            padding: 30px;
            display: none;
            z-index: 10000;
            animation: slideIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-left: 6px solid #3498db;
            pointer-events: auto;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(500px) scale(0.8);
                opacity: 0;
            }
            to {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }
        
        .notification.active {
            display: block;
            animation: floatNotification 3s ease-in-out infinite;
        }
        
        @keyframes floatNotification {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .notification-title {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notification-time {
            font-size: 1em;
            color: #4a5568;
            background: linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
        }
        
        .notification-message {
            margin-bottom: 25px;
            color: #2d3748;
            font-size: 1.2em;
            line-height: 1.6;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .notification-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1.05em;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2980b9 0%, #2573a7 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
            color: #2d3748;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #cbd5e0 0%, #a0aec0 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .status-indicator {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 12px;
            box-shadow: 0 0 10px currentColor;
        }
        
        .status-pending {
            background-color: #f39c12;
            animation: pulseWarning 2s infinite;
        }
        
        .status-completed {
            background-color: #2ecc71;
        }
        
        @keyframes pulseWarning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .overlay-toggle {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        
        .overlay-toggle:hover {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        
        .reset-btn:hover {
            background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }
        
        .test-btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3);
        }
        
        .test-btn:hover {
            background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(155, 89, 182, 0.4);
        }
        
        .auto-reminder-info {
            text-align: center;
            margin-top: 15px;
            font-size: 0.95em;
            color: #4a5568;
            padding: 15px;
            background: linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);
            border-radius: 10px;
            border: 2px dashed #cbd5e0;
        }
        
        .urgent {
            border-left-color: #e74c3c !important;
            animation: urgentPulse 1s infinite;
        }
        
        @keyframes urgentPulse {
            0% { 
                box-shadow: 0 8px 30px rgba(231, 76, 60, 0.4);
            }
            50% { 
                box-shadow: 0 15px 50px rgba(231, 76, 60, 0.7);
                transform: scale(1.05);
            }
            100% { 
                box-shadow: 0 8px 30px rgba(231, 76, 60, 0.4);
            }
        }
        
        .check-option {
            display: flex;
            align-items: center;
            margin: 20px 0;
            padding: 18px;
            background: linear-gradient(135deg, #ebf8ff 0%, #e1f5fe 100%);
            border-radius: 12px;
            border: 2px solid #bee3f8;
        }
        
        .check-option input {
            margin-right: 15px;
            transform: scale(1.6);
            accent-color: #3498db;
        }
        
        .check-option label {
            font-size: 1.1em;
            color: #2c3e50;
            font-weight: 600;
            cursor: pointer;
        }
        
        .notification-counter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            text-align: center;
            line-height: 28px;
            font-size: 0.9em;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }
        
        .notification-icon {
            font-size: 1.6em;
            margin-right: 8px;
            animation: bellRing 3s infinite;
        }
        
        @keyframes bellRing {
            0%, 55%, 100% { transform: rotate(0); }
            5%, 10% { transform: rotate(15deg); }
            15%, 20% { transform: rotate(-15deg); }
            25%, 30% { transform: rotate(10deg); }
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.6em;
            cursor: pointer;
            color: #718096;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            background: #fed7d7;
            color: #e53e3e;
            transform: rotate(90deg);
        }
        
        .system-status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #e8f4fd 0%, #d6eaf8 100%);
            border-radius: 10px;
            font-size: 1em;
            color: #2c3e50;
            border-left: 4px solid #3498db;
            font-weight: 500;
        }

        /* Lembrete flutuante avan√ßado */
        .floating-reminder {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 350px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            z-index: 2147483646;
            animation: floatIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-left: 6px solid #ffeb3b;
            transition: all 0.4s ease;
            pointer-events: auto;
            backdrop-filter: blur(10px);
        }

        .floating-reminder.minimized {
            width: 70px;
            height: 70px;
            padding: 10px;
            overflow: hidden;
            cursor: pointer;
            border-radius: 50%;
        }

        .floating-reminder.minimized:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 0 30px rgba(255, 235, 59, 0.7);
        }

        @keyframes floatIn {
            from {
                transform: translateY(100px) scale(0.7);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .floating-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .floating-title {
            font-weight: 700;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .floating-controls {
            display: flex;
            gap: 8px;
        }

        .floating-btn {
            background: rgba(255, 255, 255, 0.25);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .floating-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.2);
        }

        .floating-content {
            margin-bottom: 20px;
        }

        .floating-activity {
            font-size: 1.15em;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            border-left: 4px solid #ffeb3b;
            line-height: 1.5;
        }

        .floating-time {
            font-size: 1.1em;
            opacity: 0.95;
            text-align: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .floating-minimized-icon {
            font-size: 2em;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: spin 20s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .next-activities {
            margin-top: 15px;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .next-activity-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            align-items: center;
        }

        .next-activity-time {
            background: rgba(255, 255, 255, 0.15);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.9em;
        }

        /* Drag functionality */
        .draggable {
            cursor: move;
            user-select: none;
            padding-right: 40px;
        }

        .drag-handle {
            cursor: move;
            padding: 8px;
            background: linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);
            border-radius: 8px;
            margin-right: 15px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            font-size: 1.5em;
            color: #4a5568;
        }

        /* Status de sincroniza√ß√£o */
        .sync-status {
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.95em;
            font-weight: 500;
            display: none;
        }

        .sync-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .sync-error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .sync-loading {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        /* Checkbox de confirma√ß√£o nas atividades */
        .activity-checkbox-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .checkbox-label {
            font-size: 0.95em;
            color: #4a5568;
            white-space: nowrap;
            font-weight: 600;
        }

        /* Barra de notifica√ß√£o inferior aprimorada */
        .notebook-notification-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 18px 30px;
            z-index: 2147483645;
            box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform: translateY(100%);
            pointer-events: auto;
            backdrop-filter: blur(10px);
            border-top: 3px solid #ffeb3b;
        }

        .notebook-notification-bar.active {
            transform: translateY(0);
        }

        .notebook-notification-content {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }

        .notebook-notification-icon {
            font-size: 1.8em;
            animation: bellRing 3s infinite;
        }

        .notebook-notification-text {
            font-size: 1.2em;
            font-weight: 600;
            flex: 1;
        }

        .notebook-notification-time {
            background: rgba(255, 255, 255, 0.25);
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .notebook-notification-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .notebook-notification-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notebook-notification-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .notebook-notification-btn.primary {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }

        .notebook-notification-btn.primary:hover {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.4);
        }

        .notebook-notification-close {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .notebook-notification-close:hover {
            background: rgba(231, 76, 60, 0.8);
            transform: rotate(90deg);
        }

        .notification-indicator {
            position: fixed;
            bottom: 15px;
            right: 15px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border-radius: 50%;
            z-index: 2147483646;
            animation: indicatorPulse 2s infinite;
            display: none;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.7);
        }

        @keyframes indicatorPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        /* Progress bar para atividades */
        .progress-container {
            margin: 25px 0;
            background: #edf2f7;
            border-radius: 10px;
            overflow: hidden;
            height: 12px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #3498db 0%, #2ecc71 100%);
            width: 0%;
            transition: width 1s ease;
            border-radius: 10px;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #4a5568;
        }

        /* Modo escuro opcional */
        @media (prefers-color-scheme: dark) {
            .container {
                background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
                color: #e2e8f0;
                border-color: #4a5568;
            }
            
            .activity-item:hover {
                background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            }
            
            .activity-time {
                background: #4a5568;
                color: #e2e8f0;
            }
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 20px;
            }
            
            .notification {
                width: 90%;
                right: 5%;
                bottom: 20px;
            }
            
            .floating-reminder {
                width: 90%;
                left: 5%;
                bottom: 20px;
            }
            
            .floating-reminder.minimized {
                width: 60px;
                height: 60px;
                bottom: 20px;
                right: 20px;
                left: auto;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .notebook-notification-bar {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .notebook-notification-content {
                width: 100%;
            }
            
            .notebook-notification-actions {
                width: 100%;
                justify-content: center;
            }
        }

        /* Efeito de vidro */
        .glass-effect {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Tooltips */
        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 0.9em;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* Anima√ß√£o de entrada para itens */
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="overlay-backdrop"></div>
    
    <div class="container">
        <h1 class="draggable" data-tooltip="Arraste para reposicionar">
            <span class="drag-handle">‚â°</span> 
            ‚è∞ Sistema de Lembretes Inteligente
        </h1>
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="progress-text" id="progressText">0% conclu√≠do</div>
        
        <div class="system-status" id="systemStatus">
            ‚úÖ Carregando atividades da planilha...
        </div>

        <div id="syncStatus" class="sync-status"></div>
        
        <div class="controls">
            <button id="overlayToggle" class="btn overlay-toggle" data-tooltip="Alternar modo sobreposi√ß√£o">
                <span>üñ•Ô∏è</span> Modo Sobreposi√ß√£o
            </button>
            <button id="loadFromSheetBtn" class="btn test-btn" data-tooltip="Recarregar da planilha">
                <span>üîÑ</span> Carregar da Planilha
            </button>
            <button id="resetAll" class="btn reset-btn" data-tooltip="Reiniciar todas as atividades">
                <span>üîÑ</span> Reiniciar Todas
            </button>
        </div>
        
        <div class="activities-list">
            <h2>üìã Atividades Programadas</h2>
            <div id="activitiesContainer">
                <!-- As atividades ser√£o carregadas dinamicamente -->
                <div class="activity-item">
                    <div class="activity-info">
                        <span class="status-indicator status-pending"></span>
                        <span class="activity-name">Carregando atividades...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="auto-reminder-info">
            ‚ìò Sistema Inteligente: Os lembretes reaparecem automaticamente a cada 2 minutos at√© confirma√ß√£o.
            <br>‚úÖ Sincroniza√ß√£o autom√°tica com planilha Google.
        </div>
    </div>
    
    <!-- Notifica√ß√£o Principal -->
    <div id="notification" class="notification">
        <button class="close-btn" id="closeBtn">√ó</button>
        <div class="notification-header">
            <div class="notification-title">
                <span class="notification-icon">‚è∞</span>
                Lembrete de Atividade 
                <span id="notificationCounter" class="notification-counter" style="display: none;">1</span>
            </div>
            <div class="notification-time" id="notificationTime"></div>
        </div>
        <div class="notification-message" id="notificationMessage"></div>
        
        <div class="check-option">
            <input type="checkbox" id="markCompleted">
            <label for="markCompleted">‚úÖ Marcar como conclu√≠da e sincronizar</label>
        </div>
        
        <div class="notification-actions">
            <button id="snoozeBtn" class="btn btn-secondary" data-tooltip="Adiar por 5 minutos">
                <span>‚è∏Ô∏è</span> Adiar (5 min)
            </button>
            <button id="confirmBtn" class="btn btn-primary" data-tooltip="Confirmar e sincronizar">
                <span>‚úÖ</span> Confirmar & Sincronizar
            </button>
        </div>
    </div>

    <!-- Lembrete flutuante -->
    <div id="floatingReminder" class="floating-reminder">
        <div class="floating-header">
            <div class="floating-title">
                <span>‚è∞</span>
                <span class="floating-title-text">Lembretes Ativos</span>
            </div>
            <div class="floating-controls">
                <button class="floating-btn" id="minimizeBtn" data-tooltip="Minimizar">‚àí</button>
                <button class="floating-btn" id="closeFloatingBtn" data-tooltip="Fechar">√ó</button>
            </div>
        </div>
        <div class="floating-content">
            <div class="floating-activity" id="floatingActivity">
                Carregando atividades...
            </div>
            <div class="floating-time" id="floatingTime">
                --:--
            </div>
            <div class="next-activities" id="nextActivities">
                <!-- Pr√≥ximas atividades ser√£o inseridas aqui -->
            </div>
        </div>
    </div>

    <!-- Barra de notifica√ß√£o inferior -->
    <div id="notebookNotificationBar" class="notebook-notification-bar">
        <div class="notebook-notification-content">
            <div class="notebook-notification-icon">üîî</div>
            <div class="notebook-notification-text" id="notebookNotificationText">
                Carregando sistema...
            </div>
            <div class="notebook-notification-time" id="notebookNotificationTime">
                --:--
            </div>
        </div>
        <div class="notebook-notification-actions">
            <button class="notebook-notification-btn" id="notebookSnoozeBtn">
                <span>‚è∏Ô∏è</span> Adiar
            </button>
            <button class="notebook-notification-btn primary" id="notebookConfirmBtn">
                <span>‚úÖ</span> Confirmar
            </button>
            <button class="notebook-notification-close" id="notebookCloseBtn">√ó</button>
        </div>
    </div>

    <!-- Indicador de notifica√ß√£o -->
    <div id="notificationIndicator" class="notification-indicator"></div>

    <script>
        // ========== CONFIGURA√á√ïES GERAIS ==========
        const SHEET_ID = '1k33SVvjo-gjoZG1cWVrvm48QjUrPjtsSuEnGIYmHcUQ';
        const SHEET_NAME = 'Atividades di√°rias';
        const SCRIPT_URL = 'https://script.google.com/a/macros/mercadolivre.com/s/AKfycbw11ZllS9o2xjea50Z4ZRS6zdvYxaWrpQYpfYUyujpj9rTgKlW3uAxU7iF3zK-RgwuqeQ/exec';

        // Estado global
        let activities = [];
        let currentActivity = null;
        let timers = [];
        let snoozeTimer = null;
        let autoReminderTimer = null;
        let notebookNotificationTimer = null;
        let reminderCount = 0;
        let isFloatingMinimized = false;
        let isOverlayMode = false;
        let completedActivities = new Set();
        const AUTO_REMINDER_INTERVAL = 2 * 60 * 1000;

        // Elementos DOM
        const elements = {
            activitiesContainer: document.getElementById('activitiesContainer'),
            systemStatus: document.getElementById('systemStatus'),
            syncStatus: document.getElementById('syncStatus'),
            notification: document.getElementById('notification'),
            notificationTime: document.getElementById('notificationTime'),
            notificationMessage: document.getElementById('notificationMessage'),
            notificationCounter: document.getElementById('notificationCounter'),
            confirmBtn: document.getElementById('confirmBtn'),
            snoozeBtn: document.getElementById('snoozeBtn'),
            resetAllBtn: document.getElementById('resetAll'),
            overlayToggle: document.getElementById('overlayToggle'),
            markCompletedCheckbox: document.getElementById('markCompleted'),
            closeBtn: document.getElementById('closeBtn'),
            loadFromSheetBtn: document.getElementById('loadFromSheetBtn'),
            progressBar: document.getElementById('progressBar'),
            progressText: document.getElementById('progressText'),
            
            floatingReminder: document.getElementById('floatingReminder'),
            floatingActivity: document.getElementById('floatingActivity'),
            floatingTime: document.getElementById('floatingTime'),
            nextActivities: document.getElementById('nextActivities'),
            
            notebookNotificationBar: document.getElementById('notebookNotificationBar'),
            notebookNotificationText: document.getElementById('notebookNotificationText'),
            notebookNotificationTime: document.getElementById('notebookNotificationTime'),
            notebookSnoozeBtn: document.getElementById('notebookSnoozeBtn'),
            notebookConfirmBtn: document.getElementById('notebookConfirmBtn'),
            notebookCloseBtn: document.getElementById('notebookCloseBtn'),
            notificationIndicator: document.getElementById('notificationIndicator')
        };

        // ========== FUN√á√ïES DE CARREGAMENTO DA PLANILHA ==========

        async function loadActivitiesFromSheet() {
            showSyncStatus('üì• Carregando atividades da planilha...', 'loading');
            
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getActivities`, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar dados');
                }
                
                const data = await response.json();
                
                if (data.success && data.activities) {
                    // Processar os dados recebidos
                    activities = data.activities.map(activity => {
                        // Extrair apenas o hor√°rio da string de data
                        const timeString = activity.time;
                        let hour, minute;
                        
                        if (typeof timeString === 'string') {
                            // Tentar extrair hor√°rio da string
                            const timeMatch = timeString.match(/(\d{1,2}):(\d{2})/);
                            if (timeMatch) {
                                hour = parseInt(timeMatch[1]);
                                minute = parseInt(timeMatch[2]);
                            } else {
                                // Se n√£o encontrar formato HH:MM, usar hor√°rio padr√£o
                                hour = 0;
                                minute = 0;
                            }
                        } else if (timeString instanceof Date) {
                            // Se j√° for um objeto Date
                            hour = timeString.getHours();
                            minute = timeString.getMinutes();
                        }
                        
                        // Formatar hor√°rio como HH:MM
                        const formattedTime = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                        
                        return {
                            name: activity.name,
                            time: formattedTime,
                            rowIndex: activity.rowIndex,
                            completed: false,
                            rawTime: timeString
                        };
                    });
                    
                    // Ordenar por hor√°rio
                    activities.sort((a, b) => {
                        const timeA = convertTimeToMinutes(a.time);
                        const timeB = convertTimeToMinutes(b.time);
                        return timeA - timeB;
                    });
                    
                    showSyncStatus(`‚úÖ ${activities.length} atividades carregadas com sucesso!`, 'success');
                    elements.systemStatus.textContent = `‚úÖ ${activities.length} atividades carregadas da planilha`;
                    
                    // Carregar estado das atividades
                    loadCompletedActivities();
                    renderActivities();
                    setupTimers();
                    updateProgress();
                    updateFloatingReminder();
                    
                    return true;
                } else {
                    throw new Error('Formato de dados inv√°lido');
                }
            } catch (error) {
                console.error('Erro ao carregar atividades:', error);
                showSyncStatus('‚ùå Erro ao carregar atividades. Usando dados locais.', 'error');
                
                // Usar dados locais como fallback
                loadLocalActivities();
                return false;
            }
        }

        // Carregar dados locais como fallback
        function loadLocalActivities() {
            activities = [
                { name: "Enviar fechamento H x H | T2", time: "22:40", completed: false },
                { name: "Preencher mantra plano", time: "23:15", completed: false },
                { name: "Envio de report's", time: "23:16", completed: false },
                { name: "Envio de H x H SP09", time: "23:20", completed: false },
                { name: "Preencher Reuni√£o Di√°ria Mantra TL's", time: "23:30", completed: false },
                { name: "Preencher Rotinas", time: "23:40", completed: false },
                { name: "Verificar Matrix e Planilha de desligados(Manuten√ß√£o dos dados)", time: "01:00", completed: false },
                { name: "Verificar Reuni√µes de Piso", time: "01:30", completed: false },
                { name: "Preencher Rotinas", time: "02:00", completed: false },
                { name: "Preencher mantra Inbound", time: "04:30", completed: false },
                { name: "Enviar fechamento OOT", time: "04:15", completed: false },
                { name: "Verificar e-mails importantes", time: "05:00", completed: false },
                { name: "Fazer feedback", time: "05:15", completed: false },
                { name: "Preencher Rotinas", time: "05:40", completed: false },
                { name: "Preencher mantra plano final", time: "05:59", completed: false },
                { name: "Preencher mantra Real", time: "06:08", completed: false }
            ];
            
            loadCompletedActivities();
            renderActivities();
            setupTimers();
            updateProgress();
            updateFloatingReminder();
        }

        // ========== FUN√á√ïES DE SINCRONIZA√á√ÉO COM GOOGLE SHEETS ==========

        async function syncWithGoogleSheets(activity, action = 'complete') {
            showSyncStatus('üîÑ Sincronizando com a planilha...', 'loading');
            
            try {
                const params = new URLSearchParams({
                    action: action,
                    activity: encodeURIComponent(activity.name),
                    time: activity.time,
                    rowIndex: activity.rowIndex || 'auto',
                    timestamp: new Date().toISOString()
                });

                const response = await fetch(`${SCRIPT_URL}?${params}`, {
                    method: 'GET',
                    mode: 'cors'
                });

                if (!response.ok) {
                    throw new Error('Erro na sincroniza√ß√£o');
                }

                const data = await response.json();
                
                if (data.success) {
                    showSyncStatus('‚úÖ Sincronizado com sucesso!', 'success');
                    console.log(`Atividade "${activity.name}" sincronizada com Google Sheets`);
                    return true;
                } else {
                    throw new Error(data.message || 'Erro na sincroniza√ß√£o');
                }
                
            } catch (error) {
                console.error('Erro na sincroniza√ß√£o:', error);
                showSyncStatus('‚ö†Ô∏è Sincroniza√ß√£o offline - Dados salvos localmente', 'error');
                saveLocalData(activity);
                return false;
            }
        }

        // ========== FUN√á√ïES DE GEST√ÉO DE ATIVIDADES ==========

        function loadCompletedActivities() {
            const saved = localStorage.getItem('completedActivities');
            if (saved) {
                completedActivities = new Set(JSON.parse(saved));
                activities.forEach(activity => {
                    const key = `${activity.name}|${activity.time}`;
                    activity.completed = completedActivities.has(key);
                });
            }
            updateProgress();
        }

        function saveCompletedActivities() {
            const completedArray = Array.from(completedActivities);
            localStorage.setItem('completedActivities', JSON.stringify(completedArray));
            updateProgress();
        }

        function updateProgress() {
            const completedCount = completedActivities.size;
            const totalCount = activities.length;
            const percentage = Math.round((completedCount / totalCount) * 100);
            
            elements.progressBar.style.width = `${percentage}%`;
            elements.progressText.textContent = `${percentage}% conclu√≠do (${completedCount}/${totalCount} atividades)`;
        }

        function renderActivities() {
            elements.activitiesContainer.innerHTML = '';
            
            if (activities.length === 0) {
                elements.activitiesContainer.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-info">
                            <span class="status-indicator status-pending"></span>
                            <span class="activity-name">Nenhuma atividade carregada</span>
                        </div>
                    </div>
                `;
                return;
            }
            
            activities.forEach((activity, index) => {
                const key = `${activity.name}|${activity.time}`;
                const isCompleted = completedActivities.has(key);
                
                const activityElement = document.createElement('div');
                activityElement.className = `activity-item fade-in ${isCompleted ? 'completed' : ''}`;
                activityElement.innerHTML = `
                    <div class="activity-info">
                        <span class="status-indicator ${isCompleted ? 'status-completed' : 'status-pending'}"></span>
                        <span class="activity-time">${activity.time}</span>
                        <span class="activity-name">${activity.name}</span>
                    </div>
                    <div class="activity-checkbox-container">
                        <span class="checkbox-label">Conclu√≠da:</span>
                        <div class="activity-checkbox">
                            <input type="checkbox" id="activity-${index}" 
                                   ${isCompleted ? 'checked' : ''}
                                   data-activity-key="${key}"
                                   data-tooltip="${isCompleted ? 'Desmarcar' : 'Marcar como conclu√≠da'}">
                        </div>
                    </div>
                `;
                
                elements.activitiesContainer.appendChild(activityElement);
            });

            // Adicionar event listeners para checkboxes
            document.querySelectorAll('.activity-checkbox input').forEach(checkbox => {
                checkbox.addEventListener('change', handleActivityCheckboxChange);
            });
        }

        async function handleActivityCheckboxChange(event) {
            const checkbox = event.target;
            const activityKey = checkbox.getAttribute('data-activity-key');
            
            if (checkbox.checked) {
                // Encontrar a atividade correspondente
                const [activityName, activityTime] = activityKey.split('|');
                const activity = activities.find(a => 
                    a.name === activityName && a.time === activityTime
                );
                
                if (activity) {
                    completedActivities.add(activityKey);
                    saveCompletedActivities();
                    renderActivities();
                    setupTimers();
                    
                    // Sincronizar com Google Sheets
                    await syncWithGoogleSheets(activity);
                    
                    showSyncStatus('‚úÖ Atividade conclu√≠da e sincronizada', 'success');
                }
            } else {
                completedActivities.delete(activityKey);
                saveCompletedActivities();
                renderActivities();
                setupTimers();
            }
        }

        function convertTimeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // ========== SISTEMA DE NOTIFICA√á√ïES ==========

        function setupTimers() {
            // Limpar temporizadores existentes
            timers.forEach(timer => clearTimeout(timer));
            timers = [];
            
            const now = new Date();
            
            activities.forEach(activity => {
                const key = `${activity.name}|${activity.time}`;
                if (completedActivities.has(key)) return;
                
                const [hours, minutes] = activity.time.split(':').map(Number);
                const activityTime = new Date();
                activityTime.setHours(hours, minutes, 0, 0);
                
                // Se a hora j√° passou hoje, agendar para amanh√£
                if (activityTime < now) {
                    activityTime.setDate(activityTime.getDate() + 1);
                }
                
                const timeUntil = activityTime.getTime() - now.getTime();
                
                if (timeUntil > 0) {
                    const timer = setTimeout(() => {
                        showNotification(activity);
                    }, timeUntil);
                    
                    timers.push(timer);
                    console.log(`Agendado: ${activity.name} √†s ${activity.time} (em ${Math.round(timeUntil/60000)} min)`);
                } else if (timeUntil > -60000) { // Se passou h√° menos de 1 minuto
                    // Mostrar notifica√ß√£o imediatamente
                    setTimeout(() => {
                        showNotification(activity);
                    }, 1000);
                }
            });
            
            updateSystemStatus();
            updateFloatingReminder();
        }

        function showNotification(activity) {
            currentActivity = activity;
            reminderCount = 0;
            
            updateNotificationContent();
            elements.notification.classList.add('active');
            elements.markCompletedCheckbox.checked = false;
            playNotificationSound();
            startAutoReminder();
            
            showNotebookNotification(activity);
            
            if (!document.hasFocus()) {
                showBrowserNotification(activity);
            }
            
            console.log(`üîî Notifica√ß√£o: ${activity.name} √†s ${activity.time}`);
        }

        function updateNotificationContent() {
            if (!currentActivity) return;
            
            elements.notificationTime.textContent = currentActivity.time;
            
            let message = currentActivity.name;
            if (reminderCount > 0) {
                message += ` (Lembrete ${reminderCount + 1})`;
                elements.notificationCounter.textContent = reminderCount + 1;
                elements.notificationCounter.style.display = 'inline-flex';
                
                if (reminderCount >= 2) {
                    elements.notification.classList.add('urgent');
                }
            } else {
                elements.notificationCounter.style.display = 'none';
                elements.notification.classList.remove('urgent');
            }
            
            elements.notificationMessage.textContent = message;
        }

        function startAutoReminder() {
            if (autoReminderTimer) {
                clearTimeout(autoReminderTimer);
            }
            
            autoReminderTimer = setTimeout(() => {
                if (currentActivity) {
                    const key = `${currentActivity.name}|${currentActivity.time}`;
                    if (!completedActivities.has(key)) {
                        reminderCount++;
                        updateNotificationContent();
                        playNotificationSound();
                        updateNotebookNotification();
                        
                        if (!document.hasFocus()) {
                            showBrowserNotification(currentActivity);
                        }
                        
                        startAutoReminder();
                    }
                }
            }, AUTO_REMINDER_INTERVAL);
        }

        function stopAutoReminder() {
            if (autoReminderTimer) {
                clearTimeout(autoReminderTimer);
                autoReminderTimer = null;
            }
            reminderCount = 0;
            elements.notification.classList.remove('urgent');
            elements.notificationCounter.style.display = 'none';
        }

        function hideNotification() {
            elements.notification.classList.remove('active');
            stopAutoReminder();
            currentActivity = null;
        }

        function playNotificationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = reminderCount > 0 ? 'sawtooth' : 'sine';
                oscillator.frequency.value = reminderCount > 0 ? 600 : 800;
                gainNode.gain.value = reminderCount > 0 ? 0.2 : 0.15;
                
                oscillator.start();
                setTimeout(() => { oscillator.stop(); }, 300);
            } catch (e) {
                console.log("√Åudio n√£o suportado");
            }
        }

        // ========== NOTIFICA√á√ïES DO NAVEGADOR ==========

        function requestNotificationPermission() {
            if ("Notification" in window && Notification.permission === "default") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        console.log("‚úÖ Permiss√£o para notifica√ß√µes concedida");
                    }
                });
            }
        }

        function showBrowserNotification(activity) {
            if ("Notification" in window && Notification.permission === "granted") {
                const title = reminderCount > 0 ? 
                    `Lembrete (${reminderCount + 1}) - ${activity.time}` : 
                    `‚è∞ ${activity.time}`;
                
                const body = reminderCount > 0 ? 
                    `${activity.name} - Confirme a conclus√£o` : 
                    activity.name;
                
                const notification = new Notification(title, {
                    body: body,
                    icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚è∞</text></svg>",
                    tag: "activity-reminder",
                    requireInteraction: true
                });
                
                notification.onclick = () => {
                    window.focus();
                    notification.close();
                };
            }
        }

        // ========== BARRA DE NOTIFICA√á√ÉO INFERIOR ==========

        function showNotebookNotification(activity) {
            elements.notebookNotificationText.textContent = activity.name;
            elements.notebookNotificationTime.textContent = activity.time;
            elements.notebookNotificationBar.classList.add('active');
            elements.notificationIndicator.style.display = 'block';
            
            if (notebookNotificationTimer) {
                clearTimeout(notebookNotificationTimer);
            }
            
            notebookNotificationTimer = setTimeout(() => {
                if (elements.notebookNotificationBar.classList.contains('active')) {
                    hideNotebookNotification();
                }
            }, 30000);
        }

        function updateNotebookNotification() {
            if (currentActivity) {
                let message = currentActivity.name;
                if (reminderCount > 0) {
                    message += ` (Lembrete ${reminderCount + 1})`;
                }
                
                elements.notebookNotificationText.textContent = message;
                elements.notebookNotificationTime.textContent = currentActivity.time;
                
                if (notebookNotificationTimer) {
                    clearTimeout(notebookNotificationTimer);
                }
                
                notebookNotificationTimer = setTimeout(() => {
                    if (elements.notebookNotificationBar.classList.contains('active')) {
                        hideNotebookNotification();
                    }
                }, 30000);
            }
        }

        function hideNotebookNotification() {
            elements.notebookNotificationBar.classList.remove('active');
            elements.notificationIndicator.style.display = 'none';
            
            if (notebookNotificationTimer) {
                clearTimeout(notebookNotificationTimer);
                notebookNotificationTimer = null;
            }
        }

        // ========== LEMBRETE FLUTUANTE ==========

        function updateFloatingReminder() {
            const now = new Date();
            const pendingActivities = activities
                .filter(activity => {
                    const key = `${activity.name}|${activity.time}`;
                    return !completedActivities.has(key);
                })
                .map(activity => {
                    const [hours, minutes] = activity.time.split(':').map(Number);
                    const activityTime = new Date();
                    activityTime.setHours(hours, minutes, 0, 0);
                    
                    if (activityTime < now) {
                        activityTime.setDate(activityTime.getDate() + 1);
                    }
                    
                    return {
                        ...activity,
                        timeUntil: activityTime.getTime() - now.getTime(),
                        date: activityTime
                    };
                })
                .sort((a, b) => a.timeUntil - b.timeUntil);

            if (pendingActivities.length > 0) {
                const nextActivity = pendingActivities[0];
                const minutesUntil = Math.round(nextActivity.timeUntil / 60000);
                
                elements.floatingActivity.textContent = nextActivity.name;
                elements.floatingTime.textContent = `${nextActivity.time} (em ${minutesUntil} min)`;
                
                if (pendingActivities.length > 1) {
                    let nextActivitiesHTML = '<div style="margin-top: 10px; font-weight: bold;">üìÖ Pr√≥ximas:</div>';
                    for (let i = 1; i < Math.min(pendingActivities.length, 4); i++) {
                        const activity = pendingActivities[i];
                        const mins = Math.round(activity.timeUntil / 60000);
                        nextActivitiesHTML += `
                            <div class="next-activity-item">
                                <span>${activity.name}</span>
                                <span class="next-activity-time">${activity.time} (${mins} min)</span>
                            </div>
                        `;
                    }
                    elements.nextActivities.innerHTML = nextActivitiesHTML;
                } else {
                    elements.nextActivities.innerHTML = '';
                }
            } else {
                elements.floatingActivity.textContent = 'üéâ Todas as atividades conclu√≠das!';
                elements.floatingTime.textContent = '--:--';
                elements.nextActivities.innerHTML = '';
            }
        }

        function toggleFloatingReminder() {
            isFloatingMinimized = !isFloatingMinimized;
            
            if (isFloatingMinimized) {
                elements.floatingReminder.classList.add('minimized');
                elements.floatingReminder.innerHTML = `<div class="floating-minimized-icon">‚è∞</div>`;
                elements.floatingReminder.title = "Clique para expandir";
            } else {
                elements.floatingReminder.classList.remove('minimized');
                elements.floatingReminder.innerHTML = `
                    <div class="floating-header">
                        <div class="floating-title">
                            <span>‚è∞</span>
                            <span class="floating-title-text">Lembretes Ativos</span>
                        </div>
                        <div class="floating-controls">
                            <button class="floating-btn" id="minimizeBtn" data-tooltip="Minimizar">‚àí</button>
                            <button class="floating-btn" id="closeFloatingBtn" data-tooltip="Fechar">√ó</button>
                        </div>
                    </div>
                    <div class="floating-content">
                        <div class="floating-activity" id="floatingActivity">
                            ${elements.floatingActivity.textContent}
                        </div>
                        <div class="floating-time" id="floatingTime">
                            ${elements.floatingTime.textContent}
                        </div>
                        <div class="next-activities" id="nextActivities">
                            ${elements.nextActivities.innerHTML}
                        </div>
                    </div>
                `;
                
                document.getElementById('minimizeBtn').addEventListener('click', toggleFloatingReminder);
                document.getElementById('closeFloatingBtn').addEventListener('click', () => {
                    elements.floatingReminder.style.display = 'none';
                });
            }
        }

        // ========== FUN√á√ïES UTILIT√ÅRIAS ==========

        function updateSystemStatus() {
            const now = new Date();
            const pendingActivities = activities.filter(activity => {
                const key = `${activity.name}|${activity.time}`;
                return !completedActivities.has(key);
            });
            
            if (pendingActivities.length > 0) {
                const nextActivity = pendingActivities
                    .map(activity => {
                        const [hours, minutes] = activity.time.split(':').map(Number);
                        const activityTime = new Date();
                        activityTime.setHours(hours, minutes, 0, 0);
                        
                        if (activityTime < now) {
                            activityTime.setDate(activityTime.getDate() + 1);
                        }
                        
                        return {
                            name: activity.name,
                            time: activity.time,
                            timeUntil: activityTime.getTime() - now.getTime()
                        };
                    })
                    .sort((a, b) => a.timeUntil - b.timeUntil)[0];
                
                const minutesUntil = Math.round(nextActivity.timeUntil / 60000);
                elements.systemStatus.innerHTML = `‚è≥ <strong>Pr√≥xima atividade:</strong> ${nextActivity.name} √†s ${nextActivity.time} <br><small>(em aproximadamente ${minutesUntil} minutos)</small>`;
            } else {
                elements.systemStatus.innerHTML = '‚úÖ <strong>Todas as atividades foram conclu√≠das!</strong>';
            }
        }

        function toggleOverlayMode() {
            isOverlayMode = !isOverlayMode;
            document.body.classList.toggle('overlay-mode', isOverlayMode);
            elements.overlayToggle.innerHTML = isOverlayMode ? 
                '<span>üñ•Ô∏è</span> Modo Normal' : 
                '<span>üñ•Ô∏è</span> Modo Sobreposi√ß√£o';
            
            if (isOverlayMode) {
                document.querySelectorAll('.notification, .floating-reminder').forEach(el => {
                    el.style.zIndex = '2147483646';
                });
            }
        }

        function setupDragFunctionality() {
            const draggable = document.querySelector('.draggable');
            const container = draggable.parentElement;
            let isDragging = false;
            let startX, startY, initialX, initialY;

            draggable.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);

            function startDrag(e) {
                if (e.target.classList.contains('drag-handle') || e.target.classList.contains('draggable')) {
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    
                    const style = window.getComputedStyle(container);
                    const matrix = new DOMMatrixReadOnly(style.transform);
                    initialX = matrix.m41;
                    initialY = matrix.m42;
                    
                    e.preventDefault();
                }
            }

            function drag(e) {
                if (!isDragging) return;
                
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                
                container.style.transform = `translate(${initialX + dx}px, ${initialY + dy}px)`;
            }

            function stopDrag() {
                isDragging = false;
            }
        }

        function showSyncStatus(message, type) {
            elements.syncStatus.textContent = message;
            elements.syncStatus.className = 'sync-status';
            elements.syncStatus.classList.add(`sync-${type}`);
            elements.syncStatus.style.display = 'block';
            
            if (type !== 'loading') {
                setTimeout(() => {
                    elements.syncStatus.style.display = 'none';
                }, 5000);
            }
        }

        function saveLocalData(activity) {
            const localData = JSON.parse(localStorage.getItem('pendingSync') || '[]');
            localData.push({
                activity: activity.name,
                time: activity.time,
                rowIndex: activity.rowIndex,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('pendingSync', JSON.stringify(localData));
        }

        async function syncPendingData() {
            const pendingData = JSON.parse(localStorage.getItem('pendingSync') || '[]');
            if (pendingData.length > 0) {
                showSyncStatus(`üì° Sincronizando ${pendingData.length} itens pendentes...`, 'loading');
                
                for (const item of pendingData) {
                    await syncWithGoogleSheets(item, 'complete');
                }
                
                localStorage.removeItem('pendingSync');
                showSyncStatus('‚úÖ Todos os dados sincronizados!', 'success');
            }
        }

        // ========== EVENT LISTENERS ==========

        function setupEventListeners() {
            elements.confirmBtn.addEventListener('click', async () => {
                if (currentActivity) {
                    const key = `${currentActivity.name}|${currentActivity.time}`;
                    
                    if (elements.markCompletedCheckbox.checked) {
                        completedActivities.add(key);
                        saveCompletedActivities();
                        renderActivities();
                        setupTimers();
                        
                        await syncWithGoogleSheets(currentActivity);
                        
                        showSyncStatus('‚úÖ Atividade conclu√≠da e sincronizada', 'success');
                    }
                }
                hideNotification();
                hideNotebookNotification();
            });
            
            elements.notebookConfirmBtn.addEventListener('click', async () => {
                if (currentActivity) {
                    const key = `${currentActivity.name}|${currentActivity.time}`;
                    completedActivities.add(key);
                    saveCompletedActivities();
                    renderActivities();
                    setupTimers();
                    
                    await syncWithGoogleSheets(currentActivity);
                    
                    showSyncStatus('‚úÖ Atividade conclu√≠da via barra', 'success');
                }
                hideNotification();
                hideNotebookNotification();
            });

            elements.snoozeBtn.addEventListener('click', () => {
                hideNotification();
                hideNotebookNotification();
                if (snoozeTimer) clearTimeout(snoozeTimer);
                
                snoozeTimer = setTimeout(() => {
                    if (currentActivity) {
                        const key = `${currentActivity.name}|${currentActivity.time}`;
                        if (!completedActivities.has(key)) {
                            showNotification(currentActivity);
                        }
                    }
                }, 5 * 60 * 1000);
                
                showSyncStatus('‚è∏Ô∏è Notifica√ß√£o adiada por 5 minutos', 'success');
            });
            
            elements.notebookSnoozeBtn.addEventListener('click', () => {
                hideNotification();
                hideNotebookNotification();
                if (snoozeTimer) clearTimeout(snoozeTimer);
                
                snoozeTimer = setTimeout(() => {
                    if (currentActivity) {
                        const key = `${currentActivity.name}|${currentActivity.time}`;
                        if (!completedActivities.has(key)) {
                            showNotification(currentActivity);
                        }
                    }
                }, 5 * 60 * 1000);
                
                showSyncStatus('‚è∏Ô∏è Adiado via barra por 5 minutos', 'success');
            });

            elements.resetAllBtn.addEventListener('click', () => {
                if (confirm('Tem certeza que deseja reiniciar TODAS as atividades?')) {
                    completedActivities.clear();
                    saveCompletedActivities();
                    renderActivities();
                    setupTimers();
                    hideNotification();
                    hideNotebookNotification();
                    showSyncStatus('üîÑ Todas as atividades reiniciadas', 'success');
                }
            });

            elements.overlayToggle.addEventListener('click', toggleOverlayMode);
            elements.closeBtn.addEventListener('click', hideNotification);
            elements.notebookCloseBtn.addEventListener('click', hideNotebookNotification);

            elements.loadFromSheetBtn.addEventListener('click', async () => {
                await loadActivitiesFromSheet();
            });

            document.getElementById('minimizeBtn').addEventListener('click', toggleFloatingReminder);
            document.getElementById('closeFloatingBtn').addEventListener('click', () => {
                elements.floatingReminder.style.display = 'none';
            });

            setInterval(updateFloatingReminder, 60000);
            setInterval(updateSystemStatus, 30000);
            setInterval(syncPendingData, 300000);
            
            window.addEventListener('focus', checkMissedNotifications);
        }

        function checkMissedNotifications() {
            const now = new Date();
            activities.forEach(activity => {
                const key = `${activity.name}|${activity.time}`;
                if (!completedActivities.has(key)) {
                    const [hours, minutes] = activity.time.split(':').map(Number);
                    const activityTime = new Date();
                    activityTime.setHours(hours, minutes, 0, 0);
                    
                    const timeDiff = now.getTime() - activityTime.getTime();
                    if (timeDiff > 0 && timeDiff < 3600000) {
                        if (!currentActivity || currentActivity.name !== activity.name) {
                            showNotification(activity);
                        }
                    }
                }
            });
        }

        // ========== INICIALIZA√á√ÉO ==========

        async function init() {
            console.log('üöÄ Inicializando Sistema de Lembretes Inteligente...');
            
            setupDragFunctionality();
            setupEventListeners();
            requestNotificationPermission();
            
            await loadActivitiesFromSheet();
            
            console.log('‚úÖ Sistema iniciado com sucesso!');
            console.log(`üìä ${completedActivities.size}/${activities.length} atividades conclu√≠das`);
            
            showSyncStatus('‚úÖ Sistema carregado e pronto', 'success');
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
